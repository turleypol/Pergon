/////////////////////////////////////////////////////////////////////////////
//
//  saverchk - Saver Checker
//
//  This script checks periodically to make sure that saves are happening.
//  If they aren't, it broadcasts and syslogs.
//
/////////////////////////////////////////////////////////////////////////////

use uo;
use os;

Include "include/msgs";
Include "saveopts";

while (1)
    sleep( (MINUTES_BETWEEN_SAVES + 2) * 60 );

    var lastsave := GetGlobalProperty( "#:saver:lastsave" );
    if (!lastsave)
        BroadcastPergon( "Der Server hat noch nie eine Sicherung angelegt!" );
        syslog( "Der Server hat noch nie eine Sicherung angelegt!" );
        continue;
    endif

    var seconds_since_last := ReadGameClock() - lastsave;
    if (seconds_since_last > (MINUTES_BETWEEN_SAVES + 2) * 60)
        var minutes_old := seconds_since_last/60;
        BroadcastPergon( "Warnung! Die letzte Sicherung ist " + minutes_old + " Minuten alt." );
        syslog( "Letzte Sicherung ist " + minutes_old + " Minuten alt." );
    endif

endwhile
