//**************************************************************************************************
//
//   Ausziehen des Inkognitoitems
//
//	   Setzt den Namen wieder zurueck.
//     Item wird nach Benutzung unbrauchbar gemacht.
//
//  18.03.2003 Fraggulus: Erstellung
//  2003/08/29 Shinigami: ReWrite
//
//**************************************************************************************************

/////////////////
// Bibliotheken
/////////////////

Use uo;
Use os;

/////////////
// Includes
/////////////

Include "include/pergonutil";
Include "include/msgs";

//////////////////
// Hauptprogramm
//////////////////

Program IncognitoRobe_UnEquip(who, incogitem)
  Var oldname:=GetObjProperty(who, "realrname");
  If (oldname)
    EraseObjProperty(incogitem, "incogmasterserial");
    EraseObjProperty(who, "realrname");

    SetNamePergon(who, oldname, "IncognitoRobe - Reset");
    PrintTextAbovePrivatePergon(who, "Euer Name lautet wieder "+who.name, "Your name is "+who.name+" again.", who);
  Else
    SendSysMessagePergon(who, "Beim Zurücksetzen Eures Namens ist ein Fehler aufgetreten. Wendet Euch an einen GM.",
      "Resetting your name was not successful. Please call a GM.");
    Syslog("FEHLER: Name von '"+who.name+"' ["+Lower(Hex(who.serial))+"] konnte aufgrund fehlender CProp 'realrname' nicht zurueckgesetzt werden!");
  EndIf

  SetObjProperty(incogitem, "incogused", 1); // Robe wurde bereits benutzt...
  Start_ScriptPergon("::misc/waitdestroyitem", incogitem); // Um einen Crash des Servers zu verhindern...

  Return (1);
EndProgram
